@using Accounting.Domain.ViewModels
@using Accounting.ViewModels
@model UpdateDocumentViewModel
@{
    string getUpdatePayoutForm(Guid id) => id + "updatePayout";
    string getFormToDeleteId(Guid id, int count) => id + "formToDelete" + count;
    string getTrId(Guid id, int count) => id + "tr" + count;
}
<h4 class="text-center">Оновити - @Model.Name</h4>
<div class="container">
    <div class="row">
        <div class="col-md-5 m-auto mb-4">
            <form method="post" asp-action="Update" asp-controller="Document" id="updateDocumentfrm">
                <input type="hidden" asp-for="Id" value="@Model.Id"/>
                <label class="form-label" asp-for="Name">Назва документа</label>
                <input type="text" asp-for="Name" class="form-control" />
                <label class="form-label" asp-for="Name">Дата Створення</label>
                <input type="datetime-local" asp-for="DateCreate" class="form-control" />
                <button type="submit" class="btn btn-outline-primary m-auto">Сохранити</button>
            </form>
        </div>
        <div class="col-md-2 m-auto" id="sumAccrual">
            <h3>Сума: @Model.SumOfpayouts</h3>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div data-bs-spy="scroll" style="overflow: scroll; max-height: 600px" data-bs-root-margin="0px 0px -40%" data-bs-smooth-scroll="true" class="scrollspy-example bg-light p-3 rounded-2" tabindex="0">
                <table class="table table-hover" id="addedEmployees">
                    <thead>
                        <tr>
                            <th scope="col">Внутрішній номер</th>
                            <th scope="col">ПІБ</th>
                            <th scope="col">Начислення</th>
                        </tr>
                    </thead>
                    <tbody id="addedEmployeesTbody">
                        @foreach (var item in Model.EmployeesInDocument)
                        {
                            <tr id="@getTrId(item.Employee.Id, item.CountInSessionDocument)">
                                    <partial name="AddedPayout" model="new UpdatePayoutViewModel()
                                        {
                                            CountInSessionDocument = item.CountInSessionDocument,
                                            Ammount = item.Payout.Ammount,
                                            Employee = item.Employee,
                                            IsAdditional = item.Payout.IsAdditional,
                                            Payout = item.Payout,
                                            PayoutId = item.Payout.Id
                                        }">
                                    </partial>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
        <div class="col-md-3">
            <button type="button" class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#addEmployeeToDocumentModal">Додати в документ</button>
        </div>
    </div>
    <div class="row">
        <div class="col-md-3">
            <button type="submit" class="btn btn-outline-primary m-auto" form="updateDocumentfrm">Сохранити</button>
        </div>
    </div>
</div>
<partial name="AddEmployeeToDocumentPartial" model="Model.Employees"></partial>
@section Scripts {
    <script type="text/javascript">
        $(document).ready(function () {
            $('#addEmployeeToDocumentModal').on('shown.bs.modal', function (e) {
                $('#SearchInnerIdInput').focus();
            });
        });
        document.addEventListener('keydown', function (event) {
            if (event.code === 'Enter' || event.code === 'NumpadEnter') {

                document.getElementById('searchEmployeesbtn').click();
            }
        });
    </script>
}
